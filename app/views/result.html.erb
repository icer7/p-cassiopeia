<p id="notice"><%= notice %></p>

<h1>計測画面</h1>

<table>

  <thead>
    <tr>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <canvas style="background-color: yellow;" id="axisCanvas"></canvas>
    <div>計測結果</div>
      <a id="test-table"></a>
  </tbody>

</table>

<br>

<script>
  var canvas;
  var ctx;
  var canvasW = 400;
  var canvasH = 400;
  var mouseX1;
  var mouseY1;
  var mouseX2;
  var mouseY2;
  var count = 0;

  window.onload = function() {
    canvas = document.getElementById('axisCanvas');
    canvas.width = canvasW;
    canvas.height = canvasH;
    ctx = canvas.getContext('2d');

    canvas.onclick = function(e) {
      if (count >= 2) {
        count = 1;
        ctx.clearRect(0, 0, canvasW, canvasH);

        var rect = e.target.getBoundingClientRect();
        mouseX1 = e.clientX - Math.floor(rect.left) - 2;
        mouseY1 = e.clientY - Math.floor(rect.top) - 2;

        ctx.beginPath();
        ctx.arc(mouseX1, mouseY1, 5, 0, Math.PI * 2, false);
        ctx.fill();
      }
      else if (count == 1) {
        count += 1;
        var rect = e.target.getBoundingClientRect();
        mouseX2 = e.clientX - Math.floor(rect.left) - 2;
        mouseY2 = e.clientY - Math.floor(rect.top) - 2;

        ctx.beginPath();
        ctx.arc(mouseX2, mouseY2, 5, 0, Math.PI * 2, false);
        ctx.fill();

        var test_table = '( ' + Math.abs(mouseX1 - mouseX2) + ', ' + Math.abs(mouseY1 - mouseY2) + ' )'
        var element = document.getElementById('test-table');
        element.innerHTML = test_table;
      }
      else {
        count += 1;
        var rect = e.target.getBoundingClientRect();
        mouseX1 = e.clientX - Math.floor(rect.left) - 2;
        mouseY1 = e.clientY - Math.floor(rect.top) - 2;

        ctx.beginPath();
        ctx.arc(mouseX1, mouseY1, 5, 0, Math.PI * 2, false);
        ctx.fill();
      }
    }
  };
</script>
